# ELT_GTFS

ELT Pipeline for the Buenos Aires City GTFS Realtime Data

Project Structure:

```
├── dags                                # Airflow Dags directory
│   ├── gtfs_elt                        # Folder with functions
│      ├── api_credentials.py           # Credentials for the Buenos Aires Data API
│      ├── create_dynamic_tables.py     # Script to create the VehiclePositions Table
│      ├── functions.py                 # ELT Functions
│      ├── mobilitydb_client.py         # Classes to connect to the MobilityDB Database
│   └── ELT_VehiclePositions.py         # ELT Dag Configuration
├── data
│   ├── gtfs-realtime                   # Realtime GTFS Files
│   ├── gtfs-static                     # Static GTFS Files
│      ├── agency.txt
│      ├── calendar_dates.txt
│      ├── routes.txt
│      ├── shapes.txt
│      ├── stop_times.txt
│      ├── stops.txt
│      ├── trips.txt
├── logs                                # Logs directory generated by Airflow
├── plugins                             # Plugins directory generated by Airflow
├── scripts
│   ├── create_static_tables.sql        # SQL Script to generate and load the GTFS Static tables
├── docker-compose.yml                  # Docker Compose file to start the MobilityDB and Airflow Services
```

### A typical top-level directory layout

    .
    ├── build                   # Compiled files (alternatively `dist`)
    ├── docs                    # Documentation files (alternatively `doc`)
    ├── src                     # Source files (alternatively `lib` or `app`)
    ├── test                    # Automated tests (alternatively `spec` or `tests`)
    ├── tools                   # Tools and utilities
    ├── LICENSE
    └── README.md

> Use short lowercase names at least for the top-level files and folders except
> `LICENSE`, `README.md`



To start the ETL Process you need to:

1. Create an Client ID and Client Secret to access the Buenos Aires Data API (https://www.buenosaires.gob.ar/desarrollourbano/transporte/apitransporte) 
2. Load the credentials in the ./dags/gtfs_etl/api_credentials.py file
3. Start the Docker Process with the command:

```docker
docker compose up
```

4. Once the Docker Containers are running, you need to create the GTFS Dynamic tables with the following command:

```docker
docker exec -it elt_gtfs-airflow-worker-1 python dags/gtfs_elt/create_dynamic_tables.py
```

5. To create the static tables:

```docker
docker exec -it elt_gtfs-mobilitydb-1 psql -U docker -d mobilitydb -f create_static_tables.sql
```
